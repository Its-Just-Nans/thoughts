---
import { existsSync, mkdirSync, writeFileSync } from "node:fs";
import { basename, dirname, join } from "node:path";

export const downloadScript = async (files: { [ke: string]: string }) => {
    Object.entries(files).map(async ([url, output]) => {
        const outputDir = join("public/styles", dirname(output));
        if (!existsSync(outputDir)) {
            mkdirSync(outputDir);
        }
        const outputFile = join(outputDir, basename(output));
        if (!existsSync(outputFile)) {
            const file = await fetch(url).catch((e) => {
                throw e;
            });
            const content = await file.arrayBuffer().catch((e) => {
                throw e;
            });
            writeFileSync(outputFile, Buffer.from(content));
        }
    });
};

downloadScript({
    "https://unpkg.com/leaflet@1.9.4/dist/leaflet.css": "leaflet.css",
    "https://unpkg.com/leaflet@1.9.4/dist/leaflet.js": "leaflet.js",
    "https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png": "images/marker-icon.png",
    "https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png": "images/marker-shadow.png",
});
---

<link
    rel="stylesheet"
    href="/styles/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
/>
<script
    is:inline
    src="/styles/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>
